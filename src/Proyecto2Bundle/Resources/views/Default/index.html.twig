{% extends 'base.html.twig' %}
{% block body %}
        <div id="image">
            <div class="text-vcenter">
                <h1 class="text-white">Vuelos Python Team &copy</h1>
                <h3>Reservaciones</h3>
                <a id="busquedabtn" href="#busqueda" class="btn btn-default btn-lg">Reservar vuelos</a>
                <a id="busquedabtn2" href="#busqueda" class="btn btn-default btn-lg">Reservar vuelo+hotel</a>
            </div>
        </div>
    <div  class="card-panel" id="busqueda">
        <div class="container">
            <div id="form-messages" class="panel panel-info"></div>
        </div>
    </div>

{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.10.12/datatables.min.css"/>
    <style>
        #busqueda{
        display: none;}
    </style>
    {% endblock %}
{% block javascript %}
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.12/datatables.min.js"></script>
    <script>

        $(document).ready(function () {
            $('#busquedabtn2').click(function () {
                spa('vuelo_hotel');
                });
            $('#busquedabtn').click(function () {
                spa('vuelo');
            });
            $('#vuel').click(function () {
               tab('vuelo_index')
            });
            });

        function tab(ruta)
        {
            $.ajax
            ({
                type: 'POST',
                url: Routing.generate(ruta)
            })
                    .done(function (response) {
                        $(formMessages).removeClass('error');
                        $(formMessages).html(response);
                        $('#name').val('');
                        $('#email').val('');
                        $('#message').val('');
                        $('#tabla').dataTable();
                    })
                    .fail(function (data) {
                        $(formMessages).removeClass('success');
                        $(formMessages).addClass('error');

                        if (data.responseText !== '') {
                            $(formMessages).text(data.responseText);
                        }
                        else {
                            $(formMessages).text('Oops! An error occured and your message could not be sent.');
                        }
                    });
            if ($("#busqueda").is(':visible'))
            {

            }else
            {
                $("#busqueda").slideToggle(function ()
                {
                    if ($("#busqueda").is(':visible'))
                    {
                        $("html, body").animate({scrollTop: $("#busqueda").offset().top});
                    }
                });
            }

        }
            function spa(ruta)
            {
                $.ajax
                ({
                    type: 'POST',
                    url: Routing.generate(ruta)
                })
                .done(function (response)
                {
                            $(formMessages).removeClass('error');
                            $(formMessages).html(response);
                            $('#name').val('');
                            $('#email').val('');
                            $('#message').val('');
                })
                .fail(function (data)
                {
                    $(formMessages).removeClass('success');
                    $(formMessages).addClass('error');

                    if (data.responseText !== '')
                    {
                        $(formMessages).text(data.responseText);
                    }
                    else
                    {
                        $(formMessages).text('Oops! An error occured and your message could not be sent.');
                    }
                });
                if ($("#busqueda").is(':visible'))
                {

                }else
                {
                    $("#busqueda").slideToggle(function ()
                    {
                        if ($("#busqueda").is(':visible'))
                        {
                            $("html, body").animate({scrollTop: $("#busqueda").offset().top});
                        }
                    });
                }


                $.ajax
                ({
                    url: Routing.generate('ciudad_index'),
                    content: "JSON",
                    success: function (json)
                    {
                        $.each(json, function (i, value)
                        {
                            $('#autocomplete-destino').append($('<option>').text(value.ciudad).attr('value', value.ciudad));
                            $('#autocomplete-origen').append($('<option>').text(value.ciudad).attr('value', value.ciudad));
                        });
                    }
                });
                $.ajax
                ({
                    url: Routing.generate('tipo_index'),
                    content: "JSON",
                    success: function (json)
                    {
                        $.each(json, function (i, value)
                        {
                            $('#clase').append($('<option>').text(value.tipo).attr('value', value.tipo));
                        });
                    }
                });

                $.ajax
                ({
                    url: Routing.generate('hotel_index'),
                    content: "JSON",
                    success: function (json)
                    {
                        $.each(json, function (i, value)
                        {
                            $('#hotel').append($('<option>').text(value.hotel).attr('value', value.hotel));
                        });
                        $("select").select2({dropdownCssClass: 'dropdown-inverse'});
                    }
                });
            }

            var formulario = $('#formulario');
            var formMessages = $('#form-messages');
            formulario.submit(function (event) {
                event.preventDefault();
                var formData = $(formulario).serialize();
                $.ajax({
                    type: 'POST',
                    url: $(formulario).attr('action'),
                    data: formData
                })
                        .done(function(response) {
                            // Make sure that the formMessages div has the 'success' class.
                            $(formMessages).removeClass('error');

                            // Set the message text.
                            $(formMessages).html(response);

                            // Clear the form.
                            $('#name').val('');
                            $('#email').val('');
                            $('#message').val('');
                            $('#tabla').DataTable();
                            if ($("#tabla").is(':visible')) {
                                $("html, body").animate({scrollTop: $("#tabla").offset().top});
                            }
                        })
                        .fail(function(data) {
                            // Make sure that the formMessages div has the 'error' class.
                            $(formMessages).removeClass('success');
                            $(formMessages).addClass('error');

                            // Set the message text.
                            if (data.responseText !== '') {
                                $(formMessages).text(data.responseText);
                            } else {
                                $(formMessages).text('Oops! An error occured and your message could not be sent.');
                            }
                        })
            });
    </script>
{% endblock %}